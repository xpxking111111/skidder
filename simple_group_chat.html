<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            color: #eee;
        }

        /* Auth Screen */
        .auth-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .auth-box {
            background: #16213e;
            padding: 40px;
            border-radius: 12px;
            width: 400px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .auth-box h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #fff;
        }

        .input-field {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            background: #0f3460;
            border: 2px solid #0f3460;
            border-radius: 6px;
            color: #fff;
            font-size: 14px;
        }

        .input-field:focus {
            outline: none;
            border-color: #e94560;
        }

        .btn {
            width: 100%;
            padding: 12px;
            background: #e94560;
            border: none;
            border-radius: 6px;
            color: #fff;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        .btn:hover {
            background: #c7375f;
        }

        .switch-auth {
            text-align: center;
            margin-top: 20px;
            color: #aaa;
        }

        .switch-auth a {
            color: #e94560;
            cursor: pointer;
            text-decoration: none;
        }

        .error {
            color: #ff6b6b;
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
        }

        .hidden {
            display: none;
        }

        /* Main App */
        .app-container {
            display: none;
            height: 100vh;
            flex-direction: row;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: #16213e;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 20px;
            background: #0f3460;
            border-bottom: 2px solid #1a1a2e;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: #e94560;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
        }

        .user-info h3 {
            font-size: 16px;
            margin-bottom: 4px;
        }

        .user-info p {
            font-size: 12px;
            color: #aaa;
        }

        .tabs {
            display: flex;
            background: #0f3460;
            border-bottom: 2px solid #1a1a2e;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            background: #0f3460;
            border: none;
            color: #aaa;
            font-size: 14px;
            transition: 0.3s;
        }

        .tab.active {
            background: #16213e;
            color: #e94560;
            border-bottom: 3px solid #e94560;
        }

        .tab-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        /* Friends List */
        .friend-item {
            padding: 12px;
            margin-bottom: 8px;
            background: #0f3460;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: 0.3s;
        }

        .friend-item:hover {
            background: #1a4971;
        }

        .friend-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e94560;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .friend-info {
            flex: 1;
        }

        .friend-name {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .friend-status {
            font-size: 12px;
            color: #aaa;
        }

        .status-online {
            color: #4caf50;
        }

        /* Add Friend */
        .add-friend-section {
            margin-bottom: 20px;
        }

        .add-friend-input {
            display: flex;
            gap: 10px;
        }

        .add-friend-input input {
            flex: 1;
            padding: 10px;
            background: #0f3460;
            border: 2px solid #0f3460;
            border-radius: 6px;
            color: #fff;
        }

        .add-friend-input input:focus {
            outline: none;
            border-color: #e94560;
        }

        .add-btn {
            padding: 10px 20px;
            background: #4caf50;
            border: none;
            border-radius: 6px;
            color: #fff;
            cursor: pointer;
            font-weight: bold;
        }

        .add-btn:hover {
            background: #45a049;
        }

        .friend-requests {
            margin-top: 20px;
        }

        .friend-requests h4 {
            margin-bottom: 10px;
            color: #e94560;
        }

        .request-item {
            padding: 10px;
            background: #0f3460;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .request-actions {
            display: flex;
            gap: 8px;
        }

        .accept-btn, .reject-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
        }

        .accept-btn {
            background: #4caf50;
            color: #fff;
        }

        .reject-btn {
            background: #f44336;
            color: #fff;
        }

        /* Chat Area */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #1a1a2e;
        }

        .chat-header {
            padding: 20px;
            background: #0f3460;
            border-bottom: 2px solid #16213e;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-title {
            font-size: 20px;
            font-weight: bold;
        }

        .logout-btn {
            padding: 8px 16px;
            background: #f44336;
            border: none;
            border-radius: 6px;
            color: #fff;
            cursor: pointer;
            font-weight: bold;
        }

        .logout-btn:hover {
            background: #da190b;
        }

        .messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 12px;
            word-wrap: break-word;
        }

        .message.sent {
            align-self: flex-end;
            background: #e94560;
            color: #fff;
        }

        .message.received {
            align-self: flex-start;
            background: #0f3460;
        }

        .message-author {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 4px;
            color: #aaa;
        }

        .message.sent .message-author {
            color: #ffccd5;
        }

        .message-text {
            line-height: 1.4;
        }

        .message-time {
            font-size: 10px;
            margin-top: 4px;
            opacity: 0.7;
        }

        .no-chat {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #666;
        }

        .no-chat h2 {
            margin-bottom: 10px;
        }

        /* Message Input */
        .message-input-area {
            padding: 20px;
            background: #0f3460;
            border-top: 2px solid #16213e;
        }

        .message-input-container {
            display: flex;
            gap: 10px;
        }

        .message-input {
            flex: 1;
            padding: 12px;
            background: #16213e;
            border: 2px solid #16213e;
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
        }

        .message-input:focus {
            outline: none;
            border-color: #e94560;
        }

        .send-btn {
            padding: 12px 24px;
            background: #e94560;
            border: none;
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            font-weight: bold;
        }

        .send-btn:hover {
            background: #c7375f;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0f3460;
        }

        ::-webkit-scrollbar-thumb {
            background: #e94560;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <!-- Auth Screen -->
    <div class="auth-screen" id="authScreen">
        <div class="auth-box">
            <div id="loginForm">
                <h2>Login</h2>
                <input type="text" class="input-field" id="loginUsername" placeholder="Username">
                <input type="password" class="input-field" id="loginPassword" placeholder="Password">
                <button class="btn" onclick="login()">Login</button>
                <div class="error hidden" id="loginError"></div>
                <div class="switch-auth">
                    Don't have an account? <a onclick="showRegister()">Register</a>
                </div>
            </div>

            <div id="registerForm" class="hidden">
                <h2>Register</h2>
                <input type="text" class="input-field" id="registerUsername" placeholder="Username">
                <input type="password" class="input-field" id="registerPassword" placeholder="Password">
                <input type="password" class="input-field" id="registerConfirm" placeholder="Confirm Password">
                <button class="btn" onclick="register()">Create Account</button>
                <div class="error hidden" id="registerError"></div>
                <div class="switch-auth">
                    Already have an account? <a onclick="showLogin()">Login</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="user-profile">
                    <div class="user-avatar" id="currentUserAvatar"></div>
                    <div class="user-info">
                        <h3 id="currentUsername"></h3>
                        <p class="status-online">‚óè Online</p>
                    </div>
                </div>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('friends')">Friends</button>
                <button class="tab" onclick="switchTab('add')">Add Friend</button>
            </div>

            <div class="tab-content">
                <!-- Friends Tab -->
                <div id="friendsTab">
                    <div id="friendsList"></div>
                </div>

                <!-- Add Friend Tab -->
                <div id="addTab" class="hidden">
                    <div class="add-friend-section">
                        <h4 style="margin-bottom: 10px;">Add Friend</h4>
                        <div class="add-friend-input">
                            <input type="text" id="addFriendInput" placeholder="Enter username">
                            <button class="add-btn" onclick="sendFriendRequest()">Add</button>
                        </div>
                    </div>

                    <div class="friend-requests">
                        <h4>Friend Requests</h4>
                        <div id="requestsList"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Area -->
        <div class="chat-container">
            <div class="chat-header">
                <div>
                    <div class="chat-title" id="chatTitle">Select a friend to chat</div>
                </div>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>

            <div class="messages" id="messagesContainer">
                <div class="no-chat">
                    <h2>üëã Welcome!</h2>
                    <p>Select a friend from the list to start chatting</p>
                </div>
            </div>

            <div class="message-input-area" id="messageInputArea" style="display: none;">
                <div class="message-input-container">
                    <input type="text" class="message-input" id="messageInput" placeholder="Type a message..." onkeypress="handleEnter(event)">
                    <button class="send-btn" onclick="sendMessage()">Send</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let users = [];
        let messages = [];
        let friendRequests = [];
        let friends = [];
        let currentUser = null;
        let currentChat = null;

        function showRegister() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
            document.getElementById('loginError').classList.add('hidden');
        }

        function showLogin() {
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerError').classList.add('hidden');
        }

        function login() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            const errorEl = document.getElementById('loginError');

            if (!username || !password) {
                errorEl.textContent = 'Please fill in all fields';
                errorEl.classList.remove('hidden');
                return;
            }

            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                showApp();
            } else {
                errorEl.textContent = 'Invalid username or password';
                errorEl.classList.remove('hidden');
            }
        }

        function register() {
            const username = document.getElementById('registerUsername').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirm = document.getElementById('registerConfirm').value;
            const errorEl = document.getElementById('registerError');

            if (!username || !password || !confirm) {
                errorEl.textContent = 'Please fill in all fields';
                errorEl.classList.remove('hidden');
                return;
            }

            if (password !== confirm) {
                errorEl.textContent = 'Passwords do not match';
                errorEl.classList.remove('hidden');
                return;
            }

            if (username.length < 3) {
                errorEl.textContent = 'Username must be at least 3 characters';
                errorEl.classList.remove('hidden');
                return;
            }

            if (users.find(u => u.username === username)) {
                errorEl.textContent = 'Username already exists';
                errorEl.classList.remove('hidden');
                return;
            }

            const newUser = {
                username: username,
                password: password,
                friends: []
            };

            users.push(newUser);
            currentUser = newUser;
            showApp();
        }

        function showApp() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('appContainer').style.display = 'flex';
            document.getElementById('currentUsername').textContent = currentUser.username;
            document.getElementById('currentUserAvatar').textContent = currentUser.username[0].toUpperCase();
            loadFriends();
            loadFriendRequests();
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            if (tab === 'friends') {
                document.getElementById('friendsTab').classList.remove('hidden');
                document.getElementById('addTab').classList.add('hidden');
            } else {
                document.getElementById('friendsTab').classList.add('hidden');
                document.getElementById('addTab').classList.remove('hidden');
                loadFriendRequests();
            }
        }

        function loadFriends() {
            const friendsList = document.getElementById('friendsList');
            const userFriends = friends.filter(f => 
                f.user1 === currentUser.username || f.user2 === currentUser.username
            );

            if (userFriends.length === 0) {
                friendsList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No friends yet. Add some friends!</p>';
                return;
            }

            friendsList.innerHTML = userFriends.map(friendship => {
                const friendUsername = friendship.user1 === currentUser.username ? friendship.user2 : friendship.user1;
                return `
                    <div class="friend-item" onclick="openChat('${friendUsername}')">
                        <div class="friend-avatar">${friendUsername[0].toUpperCase()}</div>
                        <div class="friend-info">
                            <div class="friend-name">${friendUsername}</div>
                            <div class="friend-status status-online">‚óè Online</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function sendFriendRequest() {
            const input = document.getElementById('addFriendInput');
            const username = input.value.trim();

            if (!username) {
                alert('Please enter a username');
                return;
            }

            if (username === currentUser.username) {
                alert('You cannot add yourself');
                return;
            }

            const targetUser = users.find(u => u.username === username);
            if (!targetUser) {
                alert('User not found');
                return;
            }

            const alreadyFriends = friends.some(f => 
                (f.user1 === currentUser.username && f.user2 === username) ||
                (f.user2 === currentUser.username && f.user1 === username)
            );

            if (alreadyFriends) {
                alert('Already friends with this user');
                return;
            }

            const existingRequest = friendRequests.find(r => 
                r.from === currentUser.username && r.to === username
            );

            if (existingRequest) {
                alert('Friend request already sent');
                return;
            }

            friendRequests.push({
                from: currentUser.username,
                to: username
            });

            input.value = '';
            alert('Friend request sent!');
        }

        function loadFriendRequests() {
            const requestsList = document.getElementById('requestsList');
            const myRequests = friendRequests.filter(r => r.to === currentUser.username);

            if (myRequests.length === 0) {
                requestsList.innerHTML = '<p style="text-align: center; color: #666; padding: 10px;">No pending requests</p>';
                return;
            }

            requestsList.innerHTML = myRequests.map(request => `
                <div class="request-item">
                    <span>${request.from}</span>
                    <div class="request-actions">
                        <button class="accept-btn" onclick="acceptRequest('${request.from}')">Accept</button>
                        <button class="reject-btn" onclick="rejectRequest('${request.from}')">Reject</button>
                    </div>
                </div>
            `).join('');
        }

        function acceptRequest(from) {
            friends.push({
                user1: currentUser.username,
                user2: from
            });

            friendRequests = friendRequests.filter(r => 
                !(r.from === from && r.to === currentUser.username)
            );

            loadFriends();
            loadFriendRequests();
            alert(`You are now friends with ${from}!`);
        }

        function rejectRequest(from) {
            friendRequests = friendRequests.filter(r => 
                !(r.from === from && r.to === currentUser.username)
            );
            loadFriendRequests();
        }

        function openChat(friendUsername) {
            currentChat = friendUsername;
            document.getElementById('chatTitle').textContent = `Chat with ${friendUsername}`;
            document.getElementById('messageInputArea').style.display = 'block';
            loadMessages();
        }

        function loadMessages() {
            const container = document.getElementById('messagesContainer');
            const chatMessages = messages.filter(m => 
                (m.from === currentUser.username && m.to === currentChat) ||
                (m.from === currentChat && m.to === currentUser.username)
            );

            if (chatMessages.length === 0) {
                container.innerHTML = `
                    <div class="no-chat">
                        <h2>Start chatting with ${currentChat}</h2>
                        <p>Send a message to begin the conversation</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = chatMessages.map(msg => {
                const isSent = msg.from === currentUser.username;
                const time = new Date(msg.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                return `
                    <div class="message ${isSent ? 'sent' : 'received'}">
                        ${!isSent ? `<div class="message-author">${msg.from}</div>` : ''}
                        <div class="message-text">${msg.text}</div>
                        <div class="message-time">${time}</div>
                    </div>
                `;
            }).join('');

            container.scrollTop = container.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();

            if (!text || !currentChat) return;

            messages.push({
                from: currentUser.username,
                to: currentChat,
                text: text,
                timestamp: new Date()
            });

            input.value = '';
            loadMessages();
        }

        function handleEnter(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function logout() {
            currentUser = null;
            currentChat = null;
            document.getElementById('appContainer').style.display = 'none';
            document.getElementById('authScreen').style.display = 'flex';
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
        }

        // Add enter key support for login/register
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('loginPassword').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') login();
            });
            document.getElementById('registerConfirm').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') register();
            });
        });
    </script>
</body>
</html>